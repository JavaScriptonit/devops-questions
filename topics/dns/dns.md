## Вопросы:
1. Что такое DNS?
2. На каком протоколе транспортного уровня работает DNS?
3. Как работает DNS? Как настроить DNS? (DNS)
4. Какие бывают типы записей в DNS? (DNS)
5. Приведи примеры каждого типа записи. (DNS)
6. Команды и утилиты чтобы опросить DNS сервер. (DNS)
7. 

## 1. Что такое DNS?
1. DNS в `k8s`: до version 1.11 - `kube-dns` и после version 1.11 - `CoreDNS`
    1. `resolv.conf`:
    ```
    nameserver 10.32.0.10
    search namespace.svc.cluster.local svc.cluster.local cluster.local
    options ndots:5
    ```
    2. Пример Kubernetes DNS Records:
    ```
    service.namespace.svc.cluster.local

    10.32.0.125.namespace.pod.cluster.local
    ```
    3. Configuration Options - `dnsConfig` option, Updating this config will rewrite a pod’s resolv.conf to enable the changes:
    ```
    apiVersion: v1
    kind: Pod
    metadata:
    namespace: example
    name: custom-dns
    spec:
    containers:
        - name: example
        image: nginx
    dnsPolicy: "None"
    dnsConfig:
        nameservers:
        - 203.0.113.44
        searches:
        - custom.dns.local
    ```
2. Что такое `DNS`? Domain Name System, — система доменных имён. 
```
IPv4: 82.202.175.68

IPv6: 2a00:1450:4010:c08::66
```
3. Типы записей в `DNS`:
```
Основные типы ресурсных записей (Resource Records):

A-запись — задает преобразование имени хоста в IP-адрес.
MX-запись — определяет почтовый ретранслятор для доменного имени, т.е. узел, который обработает или передаст дальше почтовые сообщения, предназначенные адресату в указанном домене. При наличии нескольких MX-записей сначала происходит попытка доставить почту на ретранслятор с наименьшим приоритетом.
NS-записи — определяют DNS-серверы, которые являются авторитативными для данной зоны.
CNAME-запись — определяет отображение псевдонима в каноническое имя узла.
SRV-запись — позволяет получить имя для искомой службы, а также протокол, по которому эта служба работает.
TXT-запись — содержит общую текстовую информацию. Эти записи могут использоваться в любых целях, например, для указания месторасположения хоста.
AAAA-запись — задает преобразование имени хоста в IPV6-адрес.
SSHFP-запись — используется для хранения слепка ключей SSH в DNS.
```

## 2. На каком протоколе транспортного уровня работает DNS?

DNS использует TCP для передачи зоны и UDP в качестве имени и запрашивает обычный (основной) или обратный. UDP можно использовать для обмена небольшой информацией, тогда как протокол TCP должен использоваться для обмена данными размером более 512 байт.

## 3. Как работает DNS? Как настроить DNS? (DNS)

1. **Как работает DNS**:
   - **DNS (Domain Name System)** - это система, которая переводит доменные имена в IP-адреса и наоборот. Основные принципы работы DNS:
     - Когда вы вводите доменное имя в веб-браузере, ваш компьютер отправляет запрос DNS-серверу для получения соответствующего IP-адреса.
     - DNS-серверы содержат базы данных с записями DNS, которые соответствуют доменным именам IP-адресам.
     - DNS использует иерархическую структуру доменных имен, где домены разделены точками (например, sregistry.mts.ru).
     - Различные типы записей DNS включают A (IPv4-адрес), AAAA (IPv6-адрес), CNAME (каноническое имя), MX (почтовый сервер) и другие.

2. **Как настроить DNS**:
   - Для настройки DNS необходимо уметь работать с DNS-серверами, добавлять и изменять записи DNS, управлять зонами и кэшированием. Некоторые шаги настройки DNS:
     - Настройка DNS-сервера (например, BIND, Microsoft DNS).
     - Добавление и изменение записей DNS (A, CNAME, MX и т. д.) для привязки доменных имен к IP-адресам.
     - Управление зонами DNS, которые определяют, какие домены и поддомены обслуживает DNS-сервер.
     - Настройка кэширования DNS для ускорения процесса разрешения доменных имен.

3. **DNS безопасность**:
   - Для обеспечения безопасности DNS необходимо защищаться от DDoS-атак, DNS-подделок и других угроз безопасности. Некоторые методы защиты:
     - Использование DNSSEC (DNS Security Extensions) для обеспечения целостности и аутентичности данных DNS.
     - Настройка файрвола для блокировки нежелательных DNS-запросов и защиты от DDoS-атак.
     - Мониторинг и аудит DNS-трафика для обнаружения аномалий и подозрительной активности.
     - Регулярное обновление и усиление конфигурации DNS-серверов для предотвращения уязвимостей.

Чаще всего DevOps инженеры используют специализированные DNS-серверы, такие как BIND, PowerDNS, dnsmasq или другие, для управления DNS-зонами и обеспечения доступности и надежности DNS-сервиса.

Пример использования DNS на Ubuntu сервере Linux:
1. Установка DNS-сервера BIND:
```
sudo apt update
sudo apt install bind9
```

2. Настройка зоны DNS в файле `/etc/bind/named.conf.local`:
```bash
zone "sregistry.mts.ru" {
    type master;
    file "/etc/bind/zones/sregistry.mts.ru.zone";
};
```

3. Создание файла зоны `/etc/bind/zones/sregistry.mts.ru.zone` и добавление записей:
```bash
$TTL    604800
@       IN      SOA     ns1.sregistry.mts.ru. admin.sregistry.mts.ru. (
                2022010101  ; Serial
                604800      ; Refresh
                86400       ; Retry
                2419200     ; Expire
                604800 )    ; Negative Cache TTL
;
@       IN      NS      ns1.sregistry.mts.ru.
@       IN      A       192.168.1.10
www     IN      A       192.168.1.20
```

4. Перезапуск DNS-сервера для применения изменений: `sudo systemctl restart bind9`

Теперь сервер Ubuntu Linux будет использовать настроенный DNS-сервер для разрешения доменных имен в IP-адреса.

## 4. Какие бывают типы записей в DNS? (DNS)

Дополнительно к упомянутым типам записей DNS (A, AAAA, CNAME, MX), существуют и другие распространенные типы записей, вот некоторые из них:

1. **NS (Name Server)** - указывает на авторитетные DNS-серверы для конкретной зоны.
2. **PTR (Pointer)** - используется для обратного маппинга IP-адресов на доменные имена (reverse DNS lookup).
3. **TXT** - позволяет добавлять произвольный текстовый комментарий к доменному имени, часто используется для SPF (Sender Policy Framework) записей для электронной почты.
4. **SRV (Service)** - определяет местоположение службы в сети, таких как серверы электронной почты или VoIP.
5. **SOA (Start of Authority)** - содержит информацию об авторитетности зоны и параметры обслуживания.
6. **CAA (Certification Authority Authorization)** - определяет, какие сертификационные органы имеют право выдавать SSL-сертификаты для данного домена.
7. **SPF (Sender Policy Framework)** - определяет список IP-адресов, которые авторизованы отправлять электронную почту от имени домена.

## 5. Приведи примеры каждого типа записи. (DNS)

Примеры записей для типов A, AAAA, CNAME и MX:

1. **A (IPv4-адрес)**: 
   - Пример записи A: 
     ```
     sregistry.mts.ru. IN A 192.0.2.1
     ```
   В данном примере домен sregistry.mts.ru связан с IPv4-адресом 192.0.2.1.

2. **AAAA (IPv6-адрес)**: 
   - Пример записи AAAA: 
     ```
     sregistry.mts.ru. IN AAAA 2001:0db8:85a3:0000:0000:8a2e:0370:7334
     ```
   В данном примере домен sregistry.mts.ru связан с IPv6-адресом 2001:0db8:85a3:0000:0000:8a2e:0370:7334.

3. **CNAME (каноническое имя)**: 
   - Пример записи CNAME: 
     ```
     www.sregistry.mts.ru. IN CNAME sregistry.mts.ru.
     ```
   В данном примере поддомен www.sregistry.mts.ru перенаправляется на домен sregistry.mts.ru.

4. **MX (почтовый сервер)**: 
   - Пример записи MX: 
     ```
     sregistry.mts.ru. IN MX 10 mail.sregistry.mts.ru.
     ```
   В данном примере почтовые сообщения для домена sregistry.mts.ru будут отправляться на почтовый сервер mail.sregistry.mts.ru с приоритетом 10.

Каждая запись имеет свой синтаксис и структуру, которая определяет связь между доменным именем и соответствующими IP-адресами или другими серверами.

## 6. Команды и утилиты чтобы опросить DNS сервер. (DNS)

Существует несколько утилит и команд, которые можно использовать для опроса DNS-сервера и получения информации о доменных записях. Некоторые из наиболее распространенных утилит включают в себя `nslookup`, `dig`, `host` и `nsq`.

1. **nslookup**:
   - Пример использования:
     ```
     nslookup sregistry.mts.ru
     Name: sregistry.mts.ru
     Address: 11.215.144.1
     ```
   Эта команда позволяет выполнить DNS-запрос для домена sregistry.mts.ru и вывести информацию о соответствующих записях.

2. **host**:
   - Пример использования:
     ```bash
     host sregistry.mts.ru
     sregistry.mts.ru has address 11.215.144.1

     host -t MX mail.mtsbank.ru
     mail.mtsbank.ru is an alias for adns.mail.mtsbank.ru.
     ```
   Эта команда позволяет выполнить DNS-запрос для типа записи MX (почтовый сервер) для домена sregistry.mts.ru и вывести информацию о почтовом сервере.

3. **dig** (Domain Information Groper):
   - Пример использования:
     ```bash
     dig AAAA sregistry.mts.ru

     ; <<>> DiG 9.16.48-Ubuntu <<>> AAAA sregistry.mts.ru
     ;; global options: +cmd
     ;; Got answer:
     ;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 60238
     ;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1

     ;; OPT PSEUDOSECTION:
     ; EDNS: version: 0, flags:; udp: 65494
     ;; QUESTION SECTION:
     ;sregistry.mts.ru.              IN      AAAA

     ;; Query time: 0 msec
     ;; SERVER: 127.0.0.53#53(127.0.0.53)
     ;; WHEN: Thu Feb 29 21:08:50 MSK 2024
     ;; MSG SIZE  rcvd: 45
     ```
   1. NOERROR - это означает, что запрос был выполнен успешно и не возникло ошибок.
   2. Ответ: ANSWER: 0 - это означает, что в ответе на запрос не было найдено записей AAAA (IPv6 адресов) для домена sregistry.mts.ru.
   3. Сервер DNS: SERVER: 127.0.0.53#53(127.0.0.53) - запрос был отправлен на локальный DNS сервер с IP-адресом 127.0.0.53.
   4. Время выполнения запроса: Query time: 0 msec - запрос был выполнен за очень короткое время.
   5. Из данного вывода следует, что для домена sregistry.mts.ru отсутствуют записи AAAA (IPv6 адресов). 

Эти утилиты и команды могут быть использованы для проверки доступности DNS-сервера, получения информации о доменных записях, а также для диагностики и анализа проблем с DNS.
